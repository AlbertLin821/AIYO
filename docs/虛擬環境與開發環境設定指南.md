# 虛擬環境與開發環境設定指南

**文件版本**：1.0  
**建立日期**：2026-02-15  
**適用專案**：AIYO 愛遊互動式旅遊網站

---

## 1. 文件目的

本文件說明 AIYO 專案是否需要虛擬環境、為何需要，以及 Python 與 Node.js 各自的隔離機制與設定步驟。

---

## 2. 整體結論：是否需要虛擬環境

| 技術 | 是否需虛擬環境 | 說明 |
|------|----------------|------|
| **Python**（ai-service、video-indexer） | **建議啟用** | 避免與系統或其他專案套件衝突，強烈建議使用 |
| **Node.js**（frontend、api-gateway） | **依專案隔離** | 使用各專案 `node_modules`，無須額外虛擬環境工具 |

**結論：Python 部分建議啟用虛擬環境；Node.js 則透過專案目錄與 `node_modules` 達成隔離。**

---

## 3. Python 虛擬環境（強烈建議）

### 3.1 為何需要

1. **套件衝突**：PyTorch、sentence-transformers 等與版本高度相關，易與其他專案衝突。
2. **系統 Python**：避免修改系統 Python，降低影響其他程式。
3. **可重現性**：使用 `requirements.txt` 搭配虛擬環境，可重現相同環境。
4. **部署**：習慣虛擬環境有利後續 Docker 化與 CI/CD。

### 3.2 建議策略：各模組獨立虛擬環境

因 `ai-service` 與 `video-indexer` 依賴不同、生命週期不同，建議各自建立虛擬環境：

```
AIYO/
  ai-service/
    .venv/          <- AI 服務專用
  video-indexer/
    .venv/           <- 影片索引器專用
```

優點：模組可獨立升級、除錯、部署，互不影響。

### 3.3 Windows 設定步驟

#### ai-service

```powershell
# 進入 ai-service 目錄
cd c:\Users\Administrator\Desktop\AIYO\ai-service

# 建立虛擬環境（資料夾名 .venv）
python -m venv .venv

# 啟用虛擬環境
.\.venv\Scripts\Activate.ps1

# 若 PowerSHell 執行原則錯誤，請先執行：
# Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# 安裝依賴（建立 requirements.txt 後）
pip install -r requirements.txt
```

#### video-indexer

```powershell
# 進入 video-indexer 目錄
cd c:\Users\Administrator\Desktop\AIYO\video-indexer

# 建立虛擬環境
python -m venv .venv

# 啟用虛擬環境
.\.venv\Scripts\Activate.ps1

# 安裝依賴
pip install -r requirements.txt
```

### 3.4 macOS / Linux 設定步驟

#### ai-service

```bash
cd /path/to/AIYO/ai-service
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

#### video-indexer

```bash
cd /path/to/AIYO/video-indexer
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### 3.5 虛擬環境啟用判斷

啟用成功時，命令列前會出現 `(.venv)`：

```
(.venv) PS C:\Users\Administrator\Desktop\AIYO\video-indexer>
```

### 3.6 離開虛擬環境

```powershell
# Windows PowerShell / macOS / Linux 通用
deactivate
```

### 3.7 若選擇共用一個虛擬環境（進階）

若要統一管理 Python 依賴，可於專案根目錄建立共用虛擬環境：

```powershell
cd c:\Users\Administrator\Desktop\AIYO
python -m venv .venv
.\.venv\Scripts\Activate.ps1

# 分別安裝各模組依賴
pip install -r video-indexer/requirements.txt
pip install -r ai-service/requirements.txt
```

**注意**：兩邊若有版本衝突，需各自使用獨立虛擬環境。

---

## 4. Node.js 環境（無須 Python 式虛擬環境）

### 4.1 隔離機制

Node.js 透過各專案目錄內的 `node_modules` 達成依賴隔離，不另外使用虛擬環境工具。

### 4.2 建議作法

1. 每個前端/後端專案各自有 `package.json`。
2. 在對應目錄執行 `npm install` 或 `pnpm install`。
3. 依賴會安裝至該目錄的 `node_modules`，不影響其他專案。

### 4.3 範例

```powershell
# 前端
cd c:\Users\Administrator\Desktop\AIYO\frontend
npm install

# API Gateway
cd c:\Users\Administrator\Desktop\AIYO\api-gateway
npm install
```

### 4.4 Node 版本管理（選用）

若需管理多個 Node 版本，可使用：

- **nvm-windows**：https://github.com/coreybutler/nvm-windows
- **fnm**：https://github.com/Schniz/fnm

---

## 5. .gitignore 建議

虛擬環境目錄不應提交至 Git，建議在 `.gitignore` 中包含：

```
.venv/
venv/
env/
```

（專案 `.gitignore` 已包含上述項目）

---

## 6. 開發流程快速參考

### 日常開發（Python）

```powershell
# 影片索引器
cd video-indexer
.\.venv\Scripts\Activate.ps1
python run_indexer.py    # 範例，依實際腳本名調整

# AI 服務
cd ai-service
.\.venv\Scripts\Activate.ps1
uvicorn main:app --reload
```

### 更新依賴

```powershell
# 在已啟用虛擬環境的目錄
pip install --upgrade 某套件
pip freeze > requirements.txt   # 更新依賴清單（謹慎使用）
```

---

## 7. 常見問題

### Q1：PowerShell 顯示「無法載入檔案，因為此系統上已停用指令碼執行」

執行：

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Q2：提示找不到 python 指令

確認已安裝 Python 3.10+，並加入 PATH。可用：

```powershell
python --version
# 或
py -3 --version
```

使用 `py -3 -m venv .venv` 建立虛擬環境亦可。

### Q3：ai-service 尚未有 requirements.txt 怎麼辦

等 `ai-service` 建立後再產生。預期會包含 FastAPI、uvicorn、httpx、psycopg2、pgvector 等。

### Q4：Docker 開發時還需要本機虛擬環境嗎

- 本機直接跑 Python 腳本：**需要**虛擬環境。
- 在 Docker 內執行：由映像與 `requirements.txt` 決定環境，本機虛擬環境可省略。

---

## 8. 總結

| 項目 | 作法 |
|------|------|
| Python（ai-service、video-indexer） | 在各模組目錄建立並啟用 `.venv` |
| Node.js（frontend、api-gateway） | 使用專案內 `node_modules`，無需額外虛擬環境 |
| 版本管理 | Python：`requirements.txt`；Node：`package.json` + `package-lock.json` |

---

## 9. 參考文件

- [開發路線圖.md](./開發路線圖.md) - 開發時程與技術重點
- [技術實作指南.md](./技術實作指南.md) - 技術實作細節
